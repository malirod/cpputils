FROM malirod/cpp-dev-base

ENV HOME /root
ENV PROJECT_ROOT $HOME/project

ADD . $PROJECT_ROOT

WORKDIR $HOME

# Preconfigure thirdparties with Clang
WORKDIR $PROJECT_ROOT
RUN mkdir build-clang-debug && cd build-clang-debug && cmake .. && make -j$(nproc)
WORKDIR $PROJECT_ROOT
RUN mkdir build-clang-release && cd build-clang-release && cmake -DCMAKE_BUILD_TYPE=Release .. && make -j$(nproc)

# Preconfigure thirdparties with Gcc
WORKDIR $PROJECT_ROOT
RUN mkdir build-gcc-debug && cd build-gcc-debug && cmake -DCMAKE_CXX_COMPILER=g++ .. && make -j$(nproc)
WORKDIR $PROJECT_ROOT
RUN mkdir build-gcc-release && cd build-gcc-release && cmake -DCMAKE_CXX_COMPILER=g++ -DCMAKE_BUILD_TYPE=Release .. && make -j$(nproc)
