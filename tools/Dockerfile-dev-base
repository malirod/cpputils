FROM ubuntu:18.04

ENV HOME /root

WORKDIR $HOME

RUN apt update
RUN apt install -y wget
RUN apt install -y git
RUN apt install -y g++
RUN apt install -y make
RUN apt install -y ccache
RUN apt install -y libz-dev
RUN apt install -y libncurses-dev
RUN apt install -y libcurl4-openssl-dev
RUN apt install -y re2c
RUN apt install -y cmake

# Install Clang-6.0 (default in 18.04)
RUN apt install -y clang
RUN apt install -y clang-format
RUN apt install -y clang-tidy
RUN apt install -y libclang-dev

# Install Include-What-You-Use
RUN git clone https://github.com/include-what-you-use/include-what-you-use.git
RUN cd include-what-you-use && git checkout -b clang_6.0 origin/clang_6.0 && mkdir build && cd build && cmake -DIWYU_LLVM_ROOT_PATH=/usr/lib/llvm-6.0 -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ .. && make -j$(nproc) && make install

# Install Conan
RUN apt install -y python-pip
RUN pip install conan
RUN conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan

RUN apt install -y mc
RUN ldconfig
